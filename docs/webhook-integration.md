# Real-Time Documentation Updates via Webhooks

This document describes the webhook integration feature that enables real-time documentation updates through CI/CD pipeline integration.

## Overview

The Voltasis MCP Server now supports real-time documentation updates through GitHub webhooks. When changes are pushed to the repository, the system automatically:

1. Validates documentation changes
2. Builds and processes documentation
3. Updates the S3 bucket and DynamoDB index
4. Invalidates CloudFront cache for immediate availability

## Architecture

### Components

1. **Webhook Handler Lambda** (`webhook-handler/handler.ts`)
   - Receives and validates webhook payloads
   - Processes documentation changes
   - Updates S3 and DynamoDB
   - Triggers CloudFront cache invalidation

2. **GitHub Actions Workflow** (`.github/workflows/documentation-update.yml`)
   - Validates markdown files
   - Builds documentation
   - Triggers webhook notifications
   - Deploys to AWS infrastructure

3. **API Gateway Endpoint** (`/webhook`)
   - Receives webhook POST requests
   - No API key required (uses signature verification)
   - Routes to webhook handler Lambda

## Setup Instructions

### 1. Deploy Infrastructure

First, ensure the infrastructure is deployed with the webhook handler:

```bash
npm run cdk:deploy
```

### 2. Configure GitHub Webhook

Use the provided setup script:

```bash
npm run webhook:setup
```

This script will:
- Generate a secure webhook secret
- Configure the GitHub webhook
- Save the secret to your `.env` file

### 3. Add GitHub Secrets

Add the following secrets to your GitHub repository:

- `WEBHOOK_SECRET`: The secret generated by the setup script
- `AWS_ACCESS_KEY_ID`: Your AWS access key
- `AWS_SECRET_ACCESS_KEY`: Your AWS secret key

### 4. Test the Integration

Push a change to any markdown file in the `docs/` directory:

```bash
echo "Test update" >> docs/test.md
git add docs/test.md
git commit -m "Test webhook integration"
git push
```

## Webhook Events

The system handles the following GitHub webhook events:

### Push Events
- Triggered on commits to main/develop branches
- Processes added, modified, and removed documentation files
- Updates S3 and DynamoDB index in real-time

### Release Events
- Triggered when a new release is published
- Creates release documentation automatically
- Updates API version across all documentation

### Workflow Run Events
- Triggered when CI/CD workflows complete
- Can trigger full documentation rebuilds
- Ensures documentation stays in sync with code

## Security

### Signature Verification
All webhook requests are verified using HMAC-SHA256 signatures to ensure they originate from GitHub.

### Environment Variables
- `WEBHOOK_SECRET`: Used for signature verification
- `GITHUB_TOKEN`: Used to fetch file contents from GitHub API

## Monitoring

### CloudWatch Logs
Monitor webhook processing in CloudWatch Logs:
- Log group: `/aws/lambda/voltasis-mcp-webhook-handler-{stage}`

### Metrics
- Webhook processing time
- Success/failure rates
- Documentation update frequency

## Troubleshooting

### Common Issues

1. **Webhook signature verification fails**
   - Ensure `WEBHOOK_SECRET` matches between GitHub and Lambda
   - Check that the secret is properly configured in both places

2. **Documentation not updating**
   - Check CloudWatch logs for errors
   - Verify S3 bucket permissions
   - Ensure CloudFront invalidation is working

3. **GitHub Actions workflow fails**
   - Check workflow logs in GitHub
   - Verify AWS credentials are correct
   - Ensure all required secrets are configured

### Debug Mode

Enable debug logging by setting environment variable:
```bash
DEBUG=webhook:* npm run webhook:setup
```

## API Reference

### Webhook Endpoint

**POST** `/webhook`

Headers:
- `X-Hub-Signature-256`: GitHub webhook signature
- `X-GitHub-Event`: Event type (push, release, etc.)

Payload: GitHub webhook payload (varies by event type)

Response:
- `200 OK`: Webhook processed successfully
- `401 Unauthorized`: Invalid signature
- `500 Internal Server Error`: Processing error

## Best Practices

1. **Documentation Structure**
   - Keep documentation in `docs/` directory
   - Use consistent markdown formatting
   - Include frontmatter for metadata

2. **Version Control**
   - Tag releases for version tracking
   - Use semantic versioning
   - Document breaking changes

3. **Performance**
   - Batch documentation updates when possible
   - Use CloudFront caching effectively
   - Monitor Lambda cold starts

## Future Enhancements

- Support for additional webhook providers (GitLab, Bitbucket)
- Automated documentation generation from code
- Integration with documentation platforms
- Real-time preview environments 